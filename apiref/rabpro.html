<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>rabpro &mdash; rabpro  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="API Reference" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> rabpro
            <img src="../_static/logo_small.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/index.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/index.html">GEE and Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/index.html">Issues</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">API Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">rabpro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#rabpro-core-py">RaBPro (core.py)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-utility-functions-data-utils-py">Data utility functions (data_utils.py)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#elevation-profile-computation-elev-profile-py">Elevation Profile Computation (elev_profile.py)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#merit-utilities-merit-utils-py">MERIT Utilities (merit_utils.py)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#subbasin-statistics-subbasin-stats-py">Subbasin Statistics (subbasin_stats.py)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#subbasin-computation-subbasins-py">Subbasin Computation (subbasins.py)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#utility-functions-utils-py">Utility functions (utils.py)</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">rabpro</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">API Reference</a> &raquo;</li>
      <li>rabpro</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/apiref/rabpro.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rabpro">
<span id="id1"></span><h1>rabpro<a class="headerlink" href="#rabpro" title="Permalink to this headline"></a></h1>
<span class="target" id="module-rabpro.core"></span><section id="rabpro-core-py">
<h2>RaBPro (core.py)<a class="headerlink" href="#rabpro-core-py" title="Permalink to this headline"></a></h2>
<p>Class for running RaBPro commands on your data.</p>
<dl class="py class">
<dt class="sig sig-object py" id="rabpro.core.profiler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">rabpro.core.</span></span><span class="sig-name descname"><span class="pre">profiler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'unnamed'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path_results</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_merit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rebuild_vrts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.core.profiler" title="Permalink to this definition"></a></dt>
<dd><p>The profiler class organizes data and methods for using RaBPro. This is
a parent class to the centerline and point classes which inherit profiler
methods and attributes. You should use <cite>rabpro.profiler</cite> rather than
<cite>rabpro.core.profiler</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Attributes</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>coords</strong><span class="classifier">tuple OR list OR str OR GeoDataFrame</span></dt><dd><p>Coordinates of point(s) to delineate. A single point may be provided as
a (lat, lon) tuple. If a river centerline is being provided, its points
must be arranged US-&gt;DS. River centerline coordinates may be provided as
a list of (lat, lon) pairs. Point(s) may also be provided via a
shapefile or .csv file. If provided as .csv file, the columns must be
labeled ‘latitude’ and ‘longitude’. If a shapefile path is provided, the
shapefile may also contain columns for widths and/or along-valley
distances. These columns should have “width” and “distance” somewhere in
their column names, respectively, in order for RaBPro to exploit them.</p>
</dd>
<dt><strong>da</strong><span class="classifier">number</span></dt><dd><p>Represents the drainage area in square kilometers of the downstream-most
point in the provided coords.</p>
</dd>
<dt><strong>name</strong><span class="classifier">str</span></dt><dd><p>Name of location/river, used for filename saving purposes only.</p>
</dd>
<dt><strong>verbose</strong><span class="classifier">bool</span></dt><dd><p>If True, will print updates as processing progresses.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Methods</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>delineate_basins:</strong></p></td>
<td><p>Computes the watersheds for each lat/lon pair</p></td>
</tr>
<tr class="row-even"><td><p><strong>elev_profile:</strong></p></td>
<td><p>Compute the elevation profile</p></td>
</tr>
<tr class="row-odd"><td><p><strong>basin_stats:</strong></p></td>
<td><p>Computes watershed statistics</p></td>
</tr>
<tr class="row-even"><td><p><strong>export:</strong></p></td>
<td><p>Exports computed data</p></td>
</tr>
</tbody>
</table>
<dl class="py method">
<dt class="sig sig-object py" id="rabpro.core.profiler.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'unnamed'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path_results</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_merit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rebuild_vrts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.core.profiler.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="rabpro.core.profiler.basin_stats">
<span class="sig-name descname"><span class="pre">basin_stats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datasets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reducer_funcs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">folder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.core.profiler.basin_stats" title="Permalink to this definition"></a></dt>
<dd><p>Computes watershed statistics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>datasets</strong><span class="classifier">list of Dataset</span></dt><dd><p>Datasets to compute stats over. See the subbasin_stats.Dataset class</p>
</dd>
<dt><strong>reducer_funcs</strong><span class="classifier">list of functions</span></dt><dd><p>List of functions to apply to each feature over each dataset. Each
function should take in an ee.Feature() object. For example, this is
how the function and header are applied on a feature:
feature.set(f.__name__, function(feature))</p>
</dd>
<dt><strong>folder</strong><span class="classifier">str</span></dt><dd><p>Google Drive folder to store results in</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="rabpro.core.profiler.delineate_basins">
<span class="sig-name descname"><span class="pre">delineate_basins</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">search_radius</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">map_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.core.profiler.delineate_basins" title="Permalink to this definition"></a></dt>
<dd><p>Computes the watersheds for each lat/lon pair and adds their
drainage areas to the self.gdf <cite>GeoDataFrame</cite>.</p>
<p>There are two methods used for delineating basins: HydroBASINS and
MERIT. HydroBASINS is appropriate for large basins (500 km^2 and
larger), and MERIT can provide more detailed basin delineations for
smaller basins. The method used depends on the size of the basin, which
is interpreted via the provided drainage area. If no drainage area was
provided, HydroBASINS will be used. Otherwise, if the provided drainage
area is less than 500 km^2, MERIT will be used. MERIT may also be forced
for larger basins using the ‘force_merit’ argument when instantiating
the profiler.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>search_radius</strong><span class="classifier">numeric, optional</span></dt><dd><p>in meters, by default None</p>
</dd>
<dt><strong>map_only</strong><span class="classifier">bool, optional</span></dt><dd><p>[description], by default False</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="rabpro.core.profiler.elev_profile">
<span class="sig-name descname"><span class="pre">elev_profile</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.core.profiler.elev_profile" title="Permalink to this definition"></a></dt>
<dd><p>Compute the elevation profile.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="rabpro.core.profiler.export">
<span class="sig-name descname"><span class="pre">export</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">what</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'all'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.core.profiler.export" title="Permalink to this definition"></a></dt>
<dd><p>Exports data computed by rapbro.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>what</strong><span class="classifier">list, optional</span></dt><dd><p>Which data should be exported? Choose from
‘all’ - all computed data
‘elevs’ - centerline json is exported with elevation and distance attributes
‘subbasins’ - subbasins and incremental subbasins shapefiles
The default is ‘all’.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<span class="target" id="module-rabpro.data_utils"></span><section id="data-utility-functions-data-utils-py">
<h2>Data utility functions (data_utils.py)<a class="headerlink" href="#data-utility-functions-data-utils-py" title="Permalink to this headline"></a></h2>
</section>
<span class="target" id="module-rabpro.elev_profile"></span><section id="elevation-profile-computation-elev-profile-py">
<h2>Elevation Profile Computation (elev_profile.py)<a class="headerlink" href="#elevation-profile-computation-elev-profile-py" title="Permalink to this headline"></a></h2>
<p>Description</p>
<dl class="py function">
<dt class="sig sig-object py" id="rabpro.elev_profile.compute_dists">
<span class="sig-prename descclassname"><span class="pre">rabpro.elev_profile.</span></span><span class="sig-name descname"><span class="pre">compute_dists</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gdf</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.elev_profile.compute_dists" title="Permalink to this definition"></a></dt>
<dd><p>Computes cumulative distance in meters between points in gdf.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Desc.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>numpy.ndarray</dt><dd><p>Desc.</p>
</dd>
</dl>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><dl class="simple">
<dt>TypeError</dt><dd><p>If gdf does not contain shapely.geometry.Point values.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.elev_profile.find_nangroups">
<span class="sig-prename descclassname"><span class="pre">rabpro.elev_profile.</span></span><span class="sig-name descname"><span class="pre">find_nangroups</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.elev_profile.find_nangroups" title="Permalink to this definition"></a></dt>
<dd><p>Returns groups of nans in an array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>arr</strong><span class="classifier">[type]</span></dt><dd><p>[description]</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>list</dt><dd><p>[description]</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.elev_profile.get_rc_values">
<span class="sig-prename descclassname"><span class="pre">rabpro.elev_profile.</span></span><span class="sig-name descname"><span class="pre">get_rc_values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gdobj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nodata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">9999</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.elev_profile.get_rc_values" title="Permalink to this definition"></a></dt>
<dd><p>Returns the values within the raster pointed to by gdobj specified by
the row, col values in rc. Sets nodata. Returns numpy array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>gdobj</strong><span class="classifier">[type]</span></dt><dd><p>Points to raster to get values from</p>
</dd>
<dt><strong>rc</strong><span class="classifier">[type]</span></dt><dd><p>[description]</p>
</dd>
<dt><strong>nodata</strong><span class="classifier">int, optional</span></dt><dd><p>No data value for the raster, by default -9999</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>numpy.ndarray</dt><dd><p>Raster values</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.elev_profile.interpolate_nangroups">
<span class="sig-prename descclassname"><span class="pre">rabpro.elev_profile.</span></span><span class="sig-name descname"><span class="pre">interpolate_nangroups</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dists</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nangroups</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.elev_profile.interpolate_nangroups" title="Permalink to this definition"></a></dt>
<dd><p>Linearly interpolates across groups of nans in a 1-D array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>arr</strong><span class="classifier">[type]</span></dt><dd><p>[description]</p>
</dd>
<dt><strong>dists</strong><span class="classifier">[type]</span></dt><dd><p>[description]</p>
</dd>
<dt><strong>nangroups</strong><span class="classifier">[type]</span></dt><dd><p>[description]</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>[type]</dt><dd><p>[description]</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.elev_profile.main">
<span class="sig-prename descclassname"><span class="pre">rabpro.elev_profile.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cl_gdf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nrows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ncols</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.elev_profile.main" title="Permalink to this definition"></a></dt>
<dd><p>Description</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>cl_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Desc. Should have a column called ‘DA’ that stores drainage areas.
Should be in EPSG 4326 for use of the Haversine formula</p>
</dd>
<dt><strong>verbose</strong><span class="classifier">bool</span></dt><dd><p>Defaults to False.</p>
</dd>
<dt><strong>nrows</strong><span class="classifier">int</span></dt><dd><p>Desc. Defaults to 50.</p>
</dd>
<dt><strong>ncols</strong><span class="classifier">int</span></dt><dd><p>Desc. Defaults to 50.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>cl_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Desc.</p>
</dd>
<dt><strong>merit_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Desc.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
<span class="target" id="module-rabpro.merit_utils"></span><section id="merit-utilities-merit-utils-py">
<h2>MERIT Utilities (merit_utils.py)<a class="headerlink" href="#merit-utilities-merit-utils-py" title="Permalink to this headline"></a></h2>
<p>Utility functions for dealing with MERIT datasets</p>
<dl class="py function">
<dt class="sig sig-object py" id="rabpro.merit_utils.blob_to_polygon_shapely">
<span class="sig-prename descclassname"><span class="pre">rabpro.merit_utils.</span></span><span class="sig-name descname"><span class="pre">blob_to_polygon_shapely</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">I</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ret_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'coords'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buf_amt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.001</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.merit_utils.blob_to_polygon_shapely" title="Permalink to this definition"></a></dt>
<dd><p>Returns a list of polygons or coords.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>I</strong><span class="classifier">TYPE</span></dt><dd><p>DESCRIPTION.</p>
</dd>
<dt><strong>ret_type</strong><span class="classifier">str, optional</span></dt><dd><p>Type of data to return. Either “coords” or “pgon”. The default is
“coords”.</p>
</dd>
<dt><strong>buf_amt</strong><span class="classifier">numeric, optional</span></dt><dd><p>DESCRIPTION. By default 0.001.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>ret</strong><span class="classifier">list of numpy.ndarray or shapely.geometry.Polygon</span></dt><dd><p>DESCRIPTION.</p>
</dd>
</dl>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><dl class="simple">
<dt>ValueError</dt><dd><p>If <cite>ret_type</cite> is not “coords” or “pgon”.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.merit_utils.get_basin_pixels">
<span class="sig-prename descclassname"><span class="pre">rabpro.merit_utils.</span></span><span class="sig-name descname"><span class="pre">get_basin_pixels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_cr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">da_obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fdr_obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fdir_map</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[32,</span> <span class="pre">64,</span> <span class="pre">128,</span> <span class="pre">16,</span> <span class="pre">1,</span> <span class="pre">8,</span> <span class="pre">4,</span> <span class="pre">2]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.merit_utils.get_basin_pixels" title="Permalink to this definition"></a></dt>
<dd><p>Returns the indices of all pixels draining to the pixel defined by
start_cr.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>start_cr</strong><span class="classifier">[type]</span></dt><dd><p>[description]</p>
</dd>
<dt><strong>da_obj</strong><span class="classifier">[type]</span></dt><dd><p>[description]</p>
</dd>
<dt><strong>fdr_obj</strong><span class="classifier">[type]</span></dt><dd><p>[description]</p>
</dd>
<dt><strong>fdir_map</strong><span class="classifier">list, optional</span></dt><dd><p>[NW, N, NE, W, E, SW, S, SE], by default [32, 64, 128, 16, 1, 8, 4, 2]</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>[type]</dt><dd><p>[description]</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.merit_utils.idcs_to_geopolygons">
<span class="sig-prename descclassname"><span class="pre">rabpro.merit_utils.</span></span><span class="sig-name descname"><span class="pre">idcs_to_geopolygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">idcs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gdobj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buf_amt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.001</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.merit_utils.idcs_to_geopolygons" title="Permalink to this definition"></a></dt>
<dd><p>Given a list of of pixel indices within a raster specified by gdobj, creates
georeferenced polygons of the blobs formed by the union of the pixels.</p>
<p>“Wrapping” is also checked - this is to handle cases where the dateline
meridian is crossed and return is therefore a set of polygons rather than a
continuous one.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>idcs</strong><span class="classifier">list of integers</span></dt><dd><p>Pixel indices within the raster specified by gdobj that should be
included in the polygon.</p>
</dd>
<dt><strong>gdobj</strong><span class="classifier">osgeo.gdal.Dataset</span></dt><dd><p>Object created by gdal.Open() on a raster or virtual raster.</p>
</dd>
<dt><strong>buf_amt</strong><span class="classifier">numeric, optional</span></dt><dd><p>Amount by which to buffer pixels before unioning-helps close tiny gaps.
By default 0.001.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>pgons</strong><span class="classifier">list of shapely.geometry.Polygon</span></dt><dd><p>List of georeferenced polygons; one per blob of indices.</p>
</dd>
<dt><strong>crossing</strong><span class="classifier">bool</span></dt><dd><p>If True, the polygons represent those that cross the dateline meridian
(i.e. 180 degrees -&gt; -180 degrees) and have been split.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.merit_utils.map_cl_pt_to_flowline">
<span class="sig-prename descclassname"><span class="pre">rabpro.merit_utils.</span></span><span class="sig-name descname"><span class="pre">map_cl_pt_to_flowline</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lonlat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">da_obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nrows</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ncols</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">basin_pgon</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fdr_obj</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fdr_map</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.merit_utils.map_cl_pt_to_flowline" title="Permalink to this definition"></a></dt>
<dd><p>Maps a point of known drainage area to a flowline of a flow accumulation
grid. Returns the row, col of the mapped-to pixel. User may provide a basin
polygon (in EPSG:4326) if already known. This polygon will be used to ensure
the mapped-to-flowline is the correct one. If the basin polygon is provided,
a flow directors object and its mapping must also be provided as well as the
drainage area.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>lonlat</strong><span class="classifier">list or tuple</span></dt><dd><p>Two-element list/tuple containing (longitude, latitude) coordinates of
the point to map to a flowline.</p>
</dd>
<dt><strong>da_obj</strong><span class="classifier">osgeo.gdal.Dataset</span></dt><dd><p>Flow accumulation object. Created by gdal.Open() on raster containing
flow accumulations.</p>
</dd>
<dt><strong>nrows</strong><span class="classifier">int</span></dt><dd><p>Number of rows in the neighborhood of the point to search.</p>
</dd>
<dt><strong>ncols</strong><span class="classifier">int</span></dt><dd><p>Number of rows in the neighborhood of the point to search.</p>
</dd>
<dt><strong>da</strong><span class="classifier">float, optional</span></dt><dd><p>Drainage area of the point/gage if known. Units should correspond to
those in da_obj, typically km^2. By default None.</p>
</dd>
<dt><strong>basin_pgon</strong><span class="classifier">shapely.geometry.polygon.Polygon, optional</span></dt><dd><p>Polygon of the watershed of the point, if known. By default None.</p>
</dd>
<dt><strong>fdr_obj</strong><span class="classifier">osgeo.gdal.Dataset, optional</span></dt><dd><p>Flow direction object. Created by gdal.Open() on raster containing flow
directions. Must be specified in order to use the basin_pgon. By default
None.</p>
</dd>
<dt><strong>fdr_map</strong><span class="classifier">list, optional</span></dt><dd><p>8-entry list corresponding to the numeric value for flow directions. The
list should take the form [NW, N, NE, W, E, SW, S, SE]. By default None.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>(c_mapped, r_mapped)</strong><span class="classifier">tuple or None</span></dt><dd><p>x and y coordinates of the mapped points. If no mapping is possible,
None is returned. The x and y coordinates are with respect to the
fac_obj.</p>
</dd>
<dt><strong>solve_method</strong><span class="classifier">int</span></dt><dd><p>Indicates the reason why mapping succeeded/failed:
1 - (success) DA provided; a nearby flowline pixel was found within 15% of the provided DA
2 - (success) DA provided; match was found on a nearby flowline that is within our DA certainty bounds
3 - (success) basin polygon provided; a mappable flowline was found
4 - (success) DA not provided; mapped to the nearest flowline (&gt;1km^2)
5 - (fail) DA not provided; no nearby flowlines exist
6 - (fail) DA provided; but no nearby DAs were close enough to map to
7 - (fail) basin polygon provided; but no nearby DAs were within the allowable rang
8 - (fail) basin polygon provided; no flowlines were 25% within the provided basin</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.merit_utils.neighborhood_vals_from_raster">
<span class="sig-prename descclassname"><span class="pre">rabpro.merit_utils.</span></span><span class="sig-name descname"><span class="pre">neighborhood_vals_from_raster</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vrt_obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nodataval=&lt;Mock</span> <span class="pre">name='mock.nan'</span> <span class="pre">id='140559782547792'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wrap=None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.merit_utils.neighborhood_vals_from_raster" title="Permalink to this definition"></a></dt>
<dd><p>Queries a (virtual) raster object to return an array of neighbors
surrounding a given point specified by cr (column, row). A shape can be
provided to return as large of a neighborhood as desired; both dimensions
must be odd. This function is almost always unnecessary and could be
replaced with a single call to gdal’s ReadAsArray(), except that throws
errors when requesting a neighborhood that is beyond the boundaries of the
raster. Also note that requests for negative offsets do not throw errors,
which is dangerous. This function checks for those cases and handles them.</p>
<p>An option is provided to ‘wrap’ in cases where neighborhoods are requested
beyond the bounds of the raster. In these cases, the raster is effectively
“grown” by appending copies of itself to ensure no nodata are returned.
(This isn’t actually how the code works, just the simplest explanation.)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>cr</strong><span class="classifier">tuple</span></dt><dd><p>(column, row) indices within the virtual raster specifying the point
around which a neighborhood is requested.</p>
</dd>
<dt><strong>shape</strong><span class="classifier">tuple</span></dt><dd><p>Two-element tuple (nrows, ncols) specifying the shape of the
neighborhood around cr to query.</p>
</dd>
<dt><strong>vrt_obj</strong><span class="classifier">gdal.Dataset</span></dt><dd><p>Dataset object pointing to the raster from which to read; created by
gdal.Open(path_to_raster).</p>
</dd>
<dt><strong>nodataval</strong><span class="classifier">object</span></dt><dd><p>Value to assign neighbors that are beyond the bounds of the raster. By
default np.nan.</p>
</dd>
<dt><strong>wrap</strong><span class="classifier">str or None</span></dt><dd><p>String of ‘h’, ‘v’, or ‘hv’ denoting if horizontal and/or vertical
wrapping is desired. If None, no wrapping is performed. By default None.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>Ivals</strong><span class="classifier">np.array</span></dt><dd><p>Array of same dimensions as shape containing the neighborhood values.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.merit_utils.nrows_and_cols_from_search_radius">
<span class="sig-prename descclassname"><span class="pre">rabpro.merit_utils.</span></span><span class="sig-name descname"><span class="pre">nrows_and_cols_from_search_radius</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">search_radius</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.merit_utils.nrows_and_cols_from_search_radius" title="Permalink to this definition"></a></dt>
<dd><p>[summary]</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>lon</strong><span class="classifier">[type]</span></dt><dd><p>[description]</p>
</dd>
<dt><strong>lat</strong><span class="classifier">[type]</span></dt><dd><p>[description]</p>
</dd>
<dt><strong>search_radius</strong><span class="classifier">numeric</span></dt><dd><p>search radius in meters</p>
</dd>
<dt><strong>gt</strong><span class="classifier">[type]</span></dt><dd><p>[description]</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>nrows</strong><span class="classifier">numeric</span></dt><dd><p>[description]</p>
</dd>
<dt><strong>ncols</strong><span class="classifier">numeric</span></dt><dd><p>[description]</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.merit_utils.trace_flowpath">
<span class="sig-prename descclassname"><span class="pre">rabpro.merit_utils.</span></span><span class="sig-name descname"><span class="pre">trace_flowpath</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fdr_obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">da_obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cr_stpt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cr_enpt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_steps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fmap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[32,</span> <span class="pre">64,</span> <span class="pre">128,</span> <span class="pre">16,</span> <span class="pre">1,</span> <span class="pre">8,</span> <span class="pre">4,</span> <span class="pre">2]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.merit_utils.trace_flowpath" title="Permalink to this definition"></a></dt>
<dd><p>Walks along a flow direction grid from stpt to enpt. Returns a list of
pixels from stpt to enpt. Walks from downstream to upstream.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>fdr_obj</strong><span class="classifier">[type]</span></dt><dd><p>flow direction object opened with gdal.Open(). Assumes flow direction
symbology matches MERIT-Hydro:
32 64 128
16     1
8   4  2</p>
</dd>
<dt><strong>da_obj</strong><span class="classifier">[type]</span></dt><dd><p>[description]</p>
</dd>
<dt><strong>cr_stpt</strong><span class="classifier">[type]</span></dt><dd><p>column, row of point to start walk</p>
</dd>
<dt><strong>cr_enpt</strong><span class="classifier">[type], optional</span></dt><dd><p>column, row of point to end walk. By default None</p>
</dd>
<dt><strong>n_steps</strong><span class="classifier">[type], optional</span></dt><dd><p>number of steps (pixels) to walk before halting. By default None</p>
</dd>
<dt><strong>fmap</strong><span class="classifier">list, optional</span></dt><dd><p>[NW, N, NE, W, E, SW, S, SE], by default [32, 64, 128, 16, 1, 8, 4, 2]</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>[type]</dt><dd><p>[description]</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
<span class="target" id="module-rabpro.subbasin_stats"></span><section id="subbasin-statistics-subbasin-stats-py">
<h2>Subbasin Statistics (subbasin_stats.py)<a class="headerlink" href="#subbasin-statistics-subbasin-stats-py" title="Permalink to this headline"></a></h2>
<p>Computes subbasin statistics using Google Earth Engine.</p>
<dl class="py class">
<dt class="sig sig-object py" id="rabpro.subbasin_stats.Dataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">rabpro.subbasin_stats.</span></span><span class="sig-name descname"><span class="pre">Dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">band</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'None'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resolution</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stats</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_stats</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.subbasin_stats.Dataset" title="Permalink to this definition"></a></dt>
<dd><p>Represents one band of a GEE dataset with parameters specifying how to
compute statistics.</p>
<dl class="field-list simple">
<dt class="field-odd">Attributes</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>data_id</strong><span class="classifier">str</span></dt><dd><p>Google Earth Engine dataset asset id</p>
</dd>
<dt><strong>band</strong><span class="classifier">str, optional</span></dt><dd><p>Google Earth Engine dataset band name</p>
</dd>
<dt><strong>resolution</strong><span class="classifier">int, optional</span></dt><dd><p>Desired resolution in meters of the calculation over the dataset.
Defaults to native resolution of the dataset.</p>
</dd>
<dt><strong>start</strong><span class="classifier">str, optional</span></dt><dd><p>Desired start date of data in ISO format: YYYY-MM-DD. Defaults to
dataset start.</p>
</dd>
<dt><strong>end</strong><span class="classifier">str, optional</span></dt><dd><p>Desired end date of data in ISO format: YYYY-MM-DD. Defaults to dataset
end.</p>
</dd>
<dt><strong>stats</strong><span class="classifier">list, optional</span></dt><dd><p>List of desired stats to compute: min, max, range, mean, count, std,
sum, and percentiles in the following format: pct1, pct90, pct100, etc.
Computes [“count”, “mean”] by default.</p>
</dd>
<dt><strong>time_stats</strong><span class="classifier">list, optional</span></dt><dd><p>List of desired stats to compute through time.</p>
</dd>
<dt><strong>mask</strong><span class="classifier">bool, optional</span></dt><dd><p>Whether or not to mask out water in the dataset using the Global Surface
Water occurrence band. By default False.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="rabpro.subbasin_stats.Dataset.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">band</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'None'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resolution</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stats</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_stats</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.subbasin_stats.Dataset.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.subbasin_stats.main">
<span class="sig-prename descclassname"><span class="pre">rabpro.subbasin_stats.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gee_feature_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sb_inc_gdf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reducer_funcs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">folder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tag</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.subbasin_stats.main" title="Permalink to this definition"></a></dt>
<dd><p>Compute subbasin statistics for each dataset and band specified.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>dataset_list</strong><span class="classifier">list of Datasets</span></dt><dd><p>List of Dataset objects to compute statistics over.</p>
</dd>
<dt><strong>sb_inc_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Table of subbasin geometries.</p>
</dd>
<dt><strong>gee_feature_path</strong><span class="classifier">string</span></dt><dd><p>Path to a GEE feature collection</p>
</dd>
<dt><strong>reducer_funcs</strong><span class="classifier">list of functions, optional</span></dt><dd><p>List of functions to apply to each feature over each dataset. Each
function should take in an ee.Feature() object. For example, this is how
the function and header are applied on a feature:
feature.set(f.__name__, function(feature))</p>
</dd>
<dt><strong>verbose</strong><span class="classifier">bool, optional</span></dt><dd><p>By default False.</p>
</dd>
<dt><strong>folder</strong><span class="classifier">str, optional</span></dt><dd><p>Google Drive folder to store results in, by default top-level root.</p>
</dd>
<dt><strong>tag</strong><span class="classifier">str, optional</span></dt><dd><p>A string to append to files created on GDrive</p>
</dd>
<dt><strong>test</strong><span class="classifier">bool, optional</span></dt><dd><p>Return results to the active python session in addition to GDrive</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rabpro</span>
<span class="kn">from</span> <span class="nn">rabpro.subbasin_stats</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">box</span>

<span class="n">total_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">85.91331249</span><span class="p">,</span> <span class="mf">39.42609864</span><span class="p">,</span> <span class="o">-</span><span class="mf">85.88453019</span><span class="p">,</span> <span class="mf">39.46429816</span><span class="p">])</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s2">&quot;idx&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">box</span><span class="p">(</span><span class="o">*</span><span class="n">total_bounds</span><span class="p">)]},</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

<span class="c1"># defaults</span>
<span class="n">data</span><span class="p">,</span> <span class="n">task</span> <span class="o">=</span> <span class="n">rabpro</span><span class="o">.</span><span class="n">subbasin_stats</span><span class="o">.</span><span class="n">main</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">Dataset</span><span class="p">(</span>
            <span class="s2">&quot;JRC/GSW1_3/MonthlyRecurrence&quot;</span><span class="p">,</span>
            <span class="s2">&quot;monthly_recurrence&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">],</span>
    <span class="n">sb_inc_gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">,</span>
    <span class="n">test</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># with time_stats specified</span>
<span class="n">data</span><span class="p">,</span> <span class="n">task</span> <span class="o">=</span> <span class="n">rabpro</span><span class="o">.</span><span class="n">subbasin_stats</span><span class="o">.</span><span class="n">main</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">Dataset</span><span class="p">(</span>
            <span class="s2">&quot;JRC/GSW1_3/MonthlyRecurrence&quot;</span><span class="p">,</span>
            <span class="s2">&quot;monthly_recurrence&quot;</span><span class="p">,</span>
            <span class="n">time_stats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="p">],</span>
    <span class="n">sb_inc_gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">,</span>
    <span class="n">test</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<span class="target" id="module-rabpro.subbasins"></span><section id="subbasin-computation-subbasins-py">
<h2>Subbasin Computation (subbasins.py)<a class="headerlink" href="#subbasin-computation-subbasins-py" title="Permalink to this headline"></a></h2>
<p>Functions to calculate subbasin geometries.</p>
<dl class="py function">
<dt class="sig sig-object py" id="rabpro.subbasins.delineate_subbasins">
<span class="sig-prename descclassname"><span class="pre">rabpro.subbasins.</span></span><span class="sig-name descname"><span class="pre">delineate_subbasins</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">idxmap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">HB_gdf</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.subbasins.delineate_subbasins" title="Permalink to this definition"></a></dt>
<dd><p>Finds all the upstream contributing basins for each basin in idxmap.
This could perhaps be optimized, but the current implementation just solves
each basin in idxmap independently.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>idxmap</strong><span class="classifier">list</span></dt><dd><p>[description]</p>
</dd>
<dt><strong>HB_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>[description]</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>subHB_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Contains the polygons of each basin’s catchment</p>
</dd>
<dt><strong>inc_df</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Contains the polygons of the incremental catchments. The upstream-most
basin will be the largest polygon in most cases, but that depends on the
input centerline.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.subbasins.find_contributing_basins">
<span class="sig-prename descclassname"><span class="pre">rabpro.subbasins.</span></span><span class="sig-name descname"><span class="pre">find_contributing_basins</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">chainids</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">HB_gdf</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.subbasins.find_contributing_basins" title="Permalink to this definition"></a></dt>
<dd><p>Given an input GeoDataFrame of HydroBasins shapefiles and a list of chainids
denoting which basins are part of the chain, this function walks upstream
from the upstream-most basin by following the “NEXT_DOWN” attribute until
all possible basins are included. This process is repeated, but stops when
the previous basin is encountered. The result is a list of sets, where each
set contains the INCREMENTAL basin indices for each subbasin. i.e. the
most-downstream subbasin would be found by unioning all the sets.</p>
<p>IMPORTANT: chainids must be arranged in US-&gt;DS direction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>chainids</strong><span class="classifier">list</span></dt><dd><p>Denotes which basins are part of the chain</p>
</dd>
<dt><strong>HB_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>HydroBasins shapefiles</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>list of sets</dt><dd><p>each set contains the incremental basin indices for each subbasin</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.subbasins.initial_basin_chain">
<span class="sig-prename descclassname"><span class="pre">rabpro.subbasins.</span></span><span class="sig-name descname"><span class="pre">initial_basin_chain</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">HB_gdf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cl_gdf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buf_wid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.subbasins.initial_basin_chain" title="Permalink to this definition"></a></dt>
<dd><p>Finds the chain of drainage basins from the upstream-most centerline point
to the sink (e.g. ocean).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>HB_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>[description]</p>
</dd>
<dt><strong>cl_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Centerline coordinates</p>
</dd>
<dt><strong>buf_wid</strong><span class="classifier">float, optional</span></dt><dd><p>[description], by default 0.1</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>list</dt><dd><p>[description]</p>
</dd>
</dl>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><dl class="simple">
<dt>RuntimeError</dt><dd><p>If it cannot find a chain of basins that includes more than half the
input centerline points</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.subbasins.load_continent_basins">
<span class="sig-prename descclassname"><span class="pre">rabpro.subbasins.</span></span><span class="sig-name descname"><span class="pre">load_continent_basins</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cl_gdf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level_one</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level_twelve</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.subbasins.load_continent_basins" title="Permalink to this definition"></a></dt>
<dd><p>[summary]</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>cl_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Centerline data. Should be in EPSG:4326.</p>
</dd>
<dt><strong>level_one</strong><span class="classifier">str</span></dt><dd><p>Path to level 1 HydroBasins data</p>
</dd>
<dt><strong>level_twelve</strong><span class="classifier">str</span></dt><dd><p>Path to level 12 HydroBasins data</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>GeoDataFrame</dt><dd><p>[description]</p>
</dd>
</dl>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><dl class="simple">
<dt>ValueError</dt><dd><p>If the provided point in cl_gdf doesn’t fall in HydroBasins</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.subbasins.main_hb">
<span class="sig-prename descclassname"><span class="pre">rabpro.subbasins.</span></span><span class="sig-name descname"><span class="pre">main_hb</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cl_gdf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.subbasins.main_hb" title="Permalink to this definition"></a></dt>
<dd><p>[summary]</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>cl_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Centerline geometry</p>
</dd>
<dt><strong>verbose</strong><span class="classifier">bool, optional</span></dt><dd><p>By default False</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>subbasins_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Contains subbasin geometries</p>
</dd>
<dt><strong>sb_inc_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>[description]</p>
</dd>
<dt><strong>cl_das</strong><span class="classifier">[type]</span></dt><dd><p>Drainage areas</p>
</dd>
</dl>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><dl class="simple">
<dt>RuntimeWarning</dt><dd><p>If cl_gdf has no CRS defined</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.subbasins.main_merit">
<span class="sig-prename descclassname"><span class="pre">rabpro.subbasins.</span></span><span class="sig-name descname"><span class="pre">main_merit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cl_gdf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">da</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nrows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">51</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ncols</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">51</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">map_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.subbasins.main_merit" title="Permalink to this definition"></a></dt>
<dd><p>Calculates subbasins using MERIT</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>cl_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Centerline coordinates</p>
</dd>
<dt><strong>da</strong><span class="classifier">int</span></dt><dd><p>Drainage area</p>
</dd>
<dt><strong>nrows</strong><span class="classifier">int</span></dt><dd><p>[desc], by default 51</p>
</dd>
<dt><strong>ncols</strong><span class="classifier">int</span></dt><dd><p>[desc], by default 51</p>
</dd>
<dt><strong>mapped</strong><span class="classifier">bool</span></dt><dd><p>Don’t return subbasins. By default False</p>
</dd>
<dt><strong>verbose</strong><span class="classifier">bool</span></dt><dd><p>by default False</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>basins</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Table of subbasins</p>
</dd>
<dt><strong>mapped</strong><span class="classifier">dict</span></dt><dd><p>Contains mapped values and info</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.subbasins.map_points_to_chain">
<span class="sig-prename descclassname"><span class="pre">rabpro.subbasins.</span></span><span class="sig-name descname"><span class="pre">map_points_to_chain</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">HB_gdf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cl_gdf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chainids</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.subbasins.map_points_to_chain" title="Permalink to this definition"></a></dt>
<dd><p>Maps all centerline points to level-12 drainage basins within chain.
1. Identify the polygon each point falls into.
2. Push the points that don’t fall into a polygon into the nearest
(Euclidean distance) one.
3. Check that drainage area does not decrease as we move downstream.
If so, assign point to previous (next upstream) basin.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>HB_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>[description]</p>
</dd>
<dt><strong>cl_gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Centerline coordinates</p>
</dd>
<dt><strong>chainids</strong><span class="classifier">[type]</span></dt><dd><p>[description]</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>idxap</strong><span class="classifier">list</span></dt><dd><p>Maps each centerline point to a basin index within the HB_gdf
GeoDataFrame</p>
</dd>
<dt><strong>DA</strong><span class="classifier">int</span></dt><dd><p>Drainage areas for each centerline point</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
<span class="target" id="module-rabpro.utils"></span><section id="utility-functions-utils-py">
<h2>Utility functions (utils.py)<a class="headerlink" href="#utility-functions-utils-py" title="Permalink to this headline"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.build_vrt">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">build_vrt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tilespath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clipper</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nodataval</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">res</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sampling</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nearest'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ftype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'tif'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quiet</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.build_vrt" title="Permalink to this definition"></a></dt>
<dd><p>Creates a text file for input to gdalbuildvrt, then builds vrt file with
same name. If output path is not specified, vrt is given the name of the
final folder in the path.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>tilespath</strong><span class="classifier">str</span></dt><dd><p>the path to the file (or folder of files) to be clipped– if tilespath
contains an extension (e.g. .tif, .vrt), then that file is used.
Otherwise, a virtual raster will be built of all the files in the
provided folder. if filespath contains an extension (e.g. .tif, .vrt),
filenames of tiffs to be written to vrt. This list can be created by
tifflist and should be in the same folder</p>
</dd>
<dt><strong>clipper</strong><span class="classifier">str, optional</span></dt><dd><p>path to a georeferenced image, vrt, or shapefile that will be used to
clip. By default None</p>
</dd>
<dt><strong>extents</strong><span class="classifier">list, optional</span></dt><dd><p>the extents by which to crop the vrt. Extents should be a 4 element
list: [left, right, top, bottom] in the same projection coordinates as
the file(s) to be clipped. By default None</p>
</dd>
<dt><strong>outputfile</strong><span class="classifier">str, optional</span></dt><dd><p>path (including filename w/ext) to output the vrt. If none is provided,
the vrt will be saved in the ‘filespath’ path. By default None</p>
</dd>
<dt><strong>nodataval</strong><span class="classifier">int, optional</span></dt><dd><p>value to be masked as nodata, by default None</p>
</dd>
<dt><strong>res</strong><span class="classifier">flt, optional</span></dt><dd><p>resolution of the output vrt (applied to both x and y directions), by
default None</p>
</dd>
<dt><strong>sampling</strong><span class="classifier">str, optional</span></dt><dd><p>resampling scheme (nearest, bilinear, cubic, cubicspline, lanczos,
average, mode), by default “nearest”</p>
</dd>
<dt><strong>ftype</strong><span class="classifier">str, optional</span></dt><dd><p>“tif” if building from a list of tiffs, or “vrt” if building from a vrt,
by default “tif”</p>
</dd>
<dt><strong>separate</strong><span class="classifier">bool, optional</span></dt><dd><p>[description], by default False</p>
</dd>
<dt><strong>quiet</strong><span class="classifier">bool, optional</span></dt><dd><p>[description], by default False</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>str</dt><dd><p>path of the built virtual raster</p>
</dd>
</dl>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><dl class="simple">
<dt>TypeError</dt><dd><p>Unsupported file type passed in ‘ftype’</p>
</dd>
<dt>RuntimeError</dt><dd><p>No files found to build raster or raster build fails</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.clear_directory">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">clear_directory</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Path_obj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.clear_directory" title="Permalink to this definition"></a></dt>
<dd><p>Given a pathlib Path obj, clears all the contents of the directory. Does
not remove the directory itself.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.crop_binary_coords">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">crop_binary_coords</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coords</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.crop_binary_coords" title="Permalink to this definition"></a></dt>
<dd><p>Crops an array of (row, col) coordinates (e.g. blob indices) to the smallest
possible array.
Taken from RivGraph.im_utils</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>coords: np.array</strong></dt><dd><p>N x 2 array. First column are rows, second are columns of pixel coordinates.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>I: np.array</dt><dd><p>Image of the cropped coordinates, plus padding if desired.</p>
</dd>
<dt>clipped: list</dt><dd><p>Number of pixels in [left, top, right, bottom] direction that were
clipped.  Clipped returns the indices within the original coords image
that define where I should be positioned within the original image.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.get_datapaths">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">get_datapaths</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datapath</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">configpath</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rebuild_vrts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.get_datapaths" title="Permalink to this definition"></a></dt>
<dd><p>Returns a dictionary of paths to all data that RaBPro uses. Also builds
virtual rasters for MERIT data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>datapath: string, optional</strong></dt><dd><p>path to rabpro data folder, will read from an environment variable “RABPRO_DATA”, if not set uses appdirs</p>
</dd>
<dt><strong>configpath: string, optional</strong></dt><dd><p>path to rabpro config folder, will read from an environment variable “RABPRO_CONFIG”, if not set uses appdirs</p>
</dd>
<dt><strong>rebuild_vrts: boolean, optional</strong></dt><dd><p>rebuild virtual raster files, default is True</p>
</dd>
<dt><strong>kwargs:</strong></dt><dd><p>arguments passed to build_vrt</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>dict</dt><dd><p>contains paths to all data that RaBPro uses</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rabpro</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="n">utils</span><span class="o">.</span><span class="n">get_datapaths</span><span class="p">()</span>
<span class="n">utils</span><span class="o">.</span><span class="n">get_datapaths</span><span class="p">(</span><span class="n">extents</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">180.00041666666667</span><span class="p">,</span> <span class="mf">179.99958333333913</span><span class="p">,</span> <span class="mf">84.99958333333333</span><span class="p">,</span> <span class="o">-</span><span class="mf">60.000416666669</span><span class="p">],</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.get_exportpaths">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">get_exportpaths</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">basepath</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.get_exportpaths" title="Permalink to this definition"></a></dt>
<dd><p>Returns a dictionary of paths for exporting RaBPro results. Also creates
“results” folders when necessary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>name</strong><span class="classifier">str</span></dt><dd><p>Name of directory to create within “results” directory.</p>
</dd>
<dt><strong>basepath</strong><span class="classifier">str, optional</span></dt><dd><p>path to put “results” directory. By default None. If None, creates in
current working directory.</p>
</dd>
<dt><strong>overwrite</strong><span class="classifier">bool, optional</span></dt><dd><p>overwrite “name” directory, by default False</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>dict</dt><dd><p>contains paths to all output that RaBPro generates</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.haversine">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">haversine</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lats</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lons</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.haversine" title="Permalink to this definition"></a></dt>
<dd><p>Computes distances between latitude and longitude pairs of points.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>lats</strong><span class="classifier">numpy array (or interpretable by numpy)</span></dt><dd><p>latitude values</p>
</dd>
<dt><strong>lons</strong><span class="classifier">numpy array (or interpretable by numpy)</span></dt><dd><p>longitude values</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>numpy.ndarray</dt><dd><p>Distances between each point defined by lats, lons.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.lonlat_plus_distance">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">lonlat_plus_distance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bearing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.lonlat_plus_distance" title="Permalink to this definition"></a></dt>
<dd><p>Returns the lon, lat coordinates of a point that is dist away (dist in km)
and with a given bearing (in degrees, 0 is North). Uses a Haversine
approximation.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.parse_path">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">parse_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.parse_path" title="Permalink to this definition"></a></dt>
<dd><p>Parses a file or folderpath into: base, folder (where folder is the
outermost subdirectory), filename, and extention. Filename and extension are
empty if a directory is passed.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.raster_extents">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">raster_extents</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raster_path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.raster_extents" title="Permalink to this definition"></a></dt>
<dd><p>Output raster extents as [xmin, xmax, ymin, ymax]</p>
<dl class="simple">
<dt>Example:</dt><dd><p>import utils
utils.raster_extents(utils.get_datapaths(rebuild_vrts=False)[“DEM_fdr”])</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.regionprops">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">regionprops</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">I</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">props</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connectivity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.regionprops" title="Permalink to this definition"></a></dt>
<dd><p>Finds blobs within a binary image and returns requested properties of
each blob.
This function was modeled after matlab’s regionprops and is essentially
a wrapper for skimage’s regionprops. Not all of skimage’s available blob
properties are available here, but they can easily be added.
Taken from RivGraph.im_utils</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>I</strong><span class="classifier">np.array</span></dt><dd><p>Binary image containing blobs.</p>
</dd>
<dt><strong>props</strong><span class="classifier">list</span></dt><dd><p>Properties to compute for each blob. Can include ‘area’, ‘coords’,
‘perimeter’, ‘centroid’, ‘mean’, ‘perim_len’, ‘convex_area’,
‘eccentricity’, ‘major_axis_length’, ‘minor_axis_length’,
‘label’.</p>
</dd>
<dt><strong>connectivity</strong><span class="classifier">int, optional</span></dt><dd><p>If 1, 4-connectivity will be used to determine connected blobs. If
2, 8-connectivity will be used. The default is 2.</p>
</dd>
<dt><strong>Returns</strong></dt><dd></dd>
<dt><strong>——-</strong></dt><dd></dd>
<dt><strong>out</strong><span class="classifier">dict</span></dt><dd><p>Keys of the dictionary correspond to the requested properties. Values
for each key are lists of that property, in order such that, e.g., the
first entry of each property’s list corresponds to the same blob.</p>
</dd>
<dt><strong>Ilabeled</strong><span class="classifier">np.array</span></dt><dd><p>Image where each pixel’s value corresponds to its blob label. Labels
can be returned by specifying ‘label’ as a property.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.union_gdf_polygons">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">union_gdf_polygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gdf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idcs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buffer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.union_gdf_polygons" title="Permalink to this definition"></a></dt>
<dd><p>Given an input geodataframe and a list of indices, return a shapely geometry
that unions the geometries found at idcs into a single shapely geometry
object.</p>
<p>This function also buffers each polygon slightly, then un-buffers the
unioned polygon by the same amount. This is to avoid errors associated with
floating-point round-off; see here:
<a class="reference external" href="https://gis.stackexchange.com/questions/277334/shapely-polygon-union-results-in-strange-artifacts-of-tiny-non-overlapping-area">https://gis.stackexchange.com/questions/277334/shapely-polygon-union-results-in-strange-artifacts-of-tiny-non-overlapping-area</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>gdf</strong><span class="classifier">GeoDataFrame</span></dt><dd><p>Geometries to combine</p>
</dd>
<dt><strong>idcs</strong><span class="classifier">list</span></dt><dd><p>Indicates which geometris in ‘gdf’ to combine</p>
</dd>
<dt><strong>buffer</strong><span class="classifier">bool, optional</span></dt><dd><p>buffer polygons, by default True</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>shapely.geometry object</dt><dd><p>Union of passed geometries</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.validify_polygons">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">validify_polygons</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">polys</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.validify_polygons" title="Permalink to this definition"></a></dt>
<dd><p>Hacky ways to validify a polygon. If can’t be validified, returns the
original.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>geom</strong><span class="classifier">list</span></dt><dd><p>List of shapely.geometry.Polygon</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>geomsv</strong><span class="classifier">list</span></dt><dd><p>List of shapely.geometry.Polygon that have been attempted to validify.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="rabpro.utils.xy_to_coords">
<span class="sig-prename descclassname"><span class="pre">rabpro.utils.</span></span><span class="sig-name descname"><span class="pre">xy_to_coords</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ys</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rabpro.utils.xy_to_coords" title="Permalink to this definition"></a></dt>
<dd><p>Transforms a set of x and y coordinates to their corresponding coordinates
within a geotiff image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>xs</strong><span class="classifier">numpy.ndarray</span></dt><dd><p>x coordinates to transform</p>
</dd>
<dt><strong>ys</strong><span class="classifier">numpy.ndarray</span></dt><dd><p>y coordinates to transform</p>
</dd>
<dt><strong>gt</strong><span class="classifier">tuple</span></dt><dd><p>6-element tuple gdal GeoTransform. (uL_x, x_res, rotation, ul_y, rotation, y_res).
Automatically created by gdal’s GetGeoTransform() method.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>cx, cy</strong><span class="classifier">tuple of ints</span></dt><dd><p>Column and row indices of the provided coordinates.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="API Reference" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, T. Zussman, J. Schwenk, J. Stachelek, &amp; J. Rowland.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>